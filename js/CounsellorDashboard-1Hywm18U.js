import{d as N,_ as F,u as L}from"./index-csEBr71G.js";import{z as D,A as V,w as C,B as q}from"./firebase-w6XYyoFK.js";import{C as E}from"./collections-BIJkFGz0.js";import{r as y,c as Y,j as z,a as c,b as s,t as _,u as a,d as x,w as k,e as H,f as U,g as w,i as A,o as r}from"./vendor-BmZR9K5F.js";import"./mapbox-Dy2hBtBs.js";const j=()=>{const S=y(!1),o=y(null),d=y(0),n=y(0),u=y(0),p=y(0),T=Y(()=>({totalClients:d.value,sessionsThisMonth:n.value,averageRating:u.value.toFixed(1),hoursAvailable:p.value})),P=async l=>{try{const t=D(N,E.APPOINTMENTS),h=V(t,C("counsellorId","==",l),C("status","in",["completed","confirmed"])),v=await q(h),i=new Set;return v.forEach(g=>{const f=g.data();f.userId&&i.add(f.userId)}),i.size}catch{return 0}},e=async l=>{try{const t=D(N,E.APPOINTMENTS),h=V(t,C("counsellorId","==",l)),v=await q(h),i=new Date,g=new Date(i.getFullYear(),i.getMonth(),1),f=new Date(i.getFullYear(),i.getMonth()+1,0,23,59,59);let b=0;return v.forEach(B=>{const I=B.data(),R=I.appointmentDate?.toDate();R&&R>=g&&R<=f&&I.status==="completed"&&b++}),b}catch{return 0}},m=async l=>{try{const t=D(N,E.RATINGS),h=V(t,C("counsellorId","==",l)),v=await q(h);if(v.empty)return 0;let i=0,g=0;return v.forEach(f=>{const b=f.data();b.rating&&typeof b.rating=="number"&&(i+=b.rating,g++)}),g>0?i/g:0}catch{return 0}},O=async l=>{try{return 40}catch{return 40}};return{loading:S,error:o,practiceStats:T,totalClients:d,sessionsThisMonth:n,averageRating:u,hoursAvailable:p,fetchCounsellorStats:async l=>{if(l){S.value=!0,o.value=null;try{const[t,h,v,i]=await Promise.all([P(l),e(l),m(l),O(l)]);d.value=t,n.value=h,u.value=v,p.value=i}catch(t){o.value=t.message}finally{S.value=!1}}},resetStats:()=>{d.value=0,n.value=0,u.value=0,p.value=0,o.value=null}}},G={class:"counsellor-dashboard"},W={class:"container"},J={class:"row"},K={class:"col s12"},Q={class:"card-panel blue lighten-5"},X={class:"blue-text"},Z={class:"row"},$={class:"col s12 m6 l3"},ss={class:"card hoverable"},es={class:"card-action center-align"},ts={class:"col s12 m6 l3"},as={class:"card hoverable"},ls={class:"card-action center-align"},is={class:"col s12 m6 l3"},ns={class:"card hoverable"},os={class:"card-action center-align"},cs={class:"col s12 m6 l3"},rs={class:"card hoverable"},ds={class:"card-action center-align"},vs={class:"row"},us={class:"col s12"},ps={class:"row valign-wrapper"},hs={class:"col s4 right-align"},gs=["disabled"],_s={key:0,class:"card-panel red lighten-4 red-text"},ms={class:"col s12 m6 l3"},fs={class:"card-panel center-align"},bs={key:0,class:"preloader-wrapper small active"},ys={key:1},ws={class:"blue-text"},Ss={class:"col s12 m6 l3"},Cs={class:"card-panel center-align"},xs={key:0,class:"preloader-wrapper small active"},ks={key:1},Ms={class:"blue-text"},As={class:"col s12 m6 l3"},Ts={class:"card-panel center-align"},Rs={key:0,class:"preloader-wrapper small active"},Ns={key:1},Ds={class:"blue-text"},Vs={class:"col s12 m6 l3"},qs={class:"card-panel center-align"},Es={key:0,class:"preloader-wrapper small active"},Ps={key:1},Is={class:"blue-text"},Os={__name:"CounsellorDashboard",setup(S){const{user:o}=L(),{practiceStats:d,loading:n,error:u,fetchCounsellorStats:p}=j(),T=async()=>{o.value?.uid&&(await p(o.value.uid),M.toast({html:"Statistics refreshed!",classes:"blue"}))};return z(async()=>{o.value?.uid&&await p(o.value.uid)}),(P,e)=>{const m=H("router-link");return r(),c("div",G,[s("div",W,[s("div",J,[s("div",K,[s("div",Q,[s("h4",X,"Welcome, Dr. "+_(a(o)?.displayName)+"! ðŸ‘¨â€âš•ï¸",1),e[0]||(e[0]=s("p",{class:"grey-text text-darken-1"}," Your professional dashboard to manage your practice and help young people thrive. ",-1))])])]),s("div",Z,[e[9]||(e[9]=s("div",{class:"col s12"},[s("h5",null,"Practice Management")],-1)),s("div",$,[s("div",ss,[e[2]||(e[2]=s("div",{class:"card-content center-align"},[s("i",{class:"material-icons large blue-text"},"person"),s("span",{class:"card-title"},"My Profile"),s("p",null,"Update credentials and bio")],-1)),s("div",es,[x(m,{to:"/counsellor/profile",class:"btn blue"},{default:k(()=>[...e[1]||(e[1]=[w("Manage",-1)])]),_:1})])])]),s("div",ts,[s("div",as,[e[4]||(e[4]=s("div",{class:"card-content center-align"},[s("i",{class:"material-icons large blue-text"},"event"),s("span",{class:"card-title"},"Appointments"),s("p",null,"View and manage sessions")],-1)),s("div",ls,[x(m,{to:"/counsellor/appointments",class:"btn blue"},{default:k(()=>[...e[3]||(e[3]=[w("View",-1)])]),_:1})])])]),s("div",is,[s("div",ns,[e[6]||(e[6]=s("div",{class:"card-content center-align"},[s("i",{class:"material-icons large blue-text"},"schedule"),s("span",{class:"card-title"},"Availability"),s("p",null,"Set your working hours")],-1)),s("div",os,[x(m,{to:"/counsellor/availability",class:"btn blue"},{default:k(()=>[...e[5]||(e[5]=[w("Update",-1)])]),_:1})])])]),s("div",cs,[s("div",rs,[e[8]||(e[8]=s("div",{class:"card-content center-align"},[s("i",{class:"material-icons large blue-text"},"star"),s("span",{class:"card-title"},"Ratings"),s("p",null,"View client feedback")],-1)),s("div",ds,[x(m,{to:"/counsellor/ratings",class:"btn blue"},{default:k(()=>[...e[7]||(e[7]=[w("View",-1)])]),_:1})])])])]),s("div",vs,[s("div",us,[s("div",ps,[e[11]||(e[11]=s("div",{class:"col s8"},[s("h5",null,"Performance Overview")],-1)),s("div",hs,[s("button",{onClick:T,class:"btn-small blue waves-effect waves-light",disabled:a(n),style:{"margin-left":"0.5rem"}},[e[10]||(e[10]=s("i",{class:"material-icons left"},"refresh",-1)),w(" "+_(a(n)?"Loading...":"Refresh"),1)],8,gs)])]),a(u)?(r(),c("div",_s,[e[12]||(e[12]=s("i",{class:"material-icons left"},"error",-1)),w(" Error loading statistics: "+_(a(u)),1)])):U("",!0)]),s("div",ms,[s("div",fs,[a(n)?(r(),c("div",bs,[...e[13]||(e[13]=[A('<div class="spinner-layer spinner-blue-only" data-v-437e79e7><div class="circle-clipper left" data-v-437e79e7><div class="circle" data-v-437e79e7></div></div><div class="gap-patch" data-v-437e79e7><div class="circle" data-v-437e79e7></div></div><div class="circle-clipper right" data-v-437e79e7><div class="circle" data-v-437e79e7></div></div></div>',1)])])):(r(),c("div",ys,[s("h4",ws,_(a(d).totalClients),1),e[14]||(e[14]=s("p",null,"Total Clients",-1))]))])]),s("div",Ss,[s("div",Cs,[a(n)?(r(),c("div",xs,[...e[15]||(e[15]=[A('<div class="spinner-layer spinner-blue-only" data-v-437e79e7><div class="circle-clipper left" data-v-437e79e7><div class="circle" data-v-437e79e7></div></div><div class="gap-patch" data-v-437e79e7><div class="circle" data-v-437e79e7></div></div><div class="circle-clipper right" data-v-437e79e7><div class="circle" data-v-437e79e7></div></div></div>',1)])])):(r(),c("div",ks,[s("h4",Ms,_(a(d).sessionsThisMonth),1),e[16]||(e[16]=s("p",null,"Sessions This Month",-1))]))])]),s("div",As,[s("div",Ts,[a(n)?(r(),c("div",Rs,[...e[17]||(e[17]=[A('<div class="spinner-layer spinner-blue-only" data-v-437e79e7><div class="circle-clipper left" data-v-437e79e7><div class="circle" data-v-437e79e7></div></div><div class="gap-patch" data-v-437e79e7><div class="circle" data-v-437e79e7></div></div><div class="circle-clipper right" data-v-437e79e7><div class="circle" data-v-437e79e7></div></div></div>',1)])])):(r(),c("div",Ns,[s("h4",Ds,_(a(d).averageRating),1),e[18]||(e[18]=s("p",null,"Average Rating",-1))]))])]),s("div",Vs,[s("div",qs,[a(n)?(r(),c("div",Es,[...e[19]||(e[19]=[A('<div class="spinner-layer spinner-blue-only" data-v-437e79e7><div class="circle-clipper left" data-v-437e79e7><div class="circle" data-v-437e79e7></div></div><div class="gap-patch" data-v-437e79e7><div class="circle" data-v-437e79e7></div></div><div class="circle-clipper right" data-v-437e79e7><div class="circle" data-v-437e79e7></div></div></div>',1)])])):(r(),c("div",Ps,[s("h4",Is,_(a(d).hoursAvailable),1),e[20]||(e[20]=s("p",null,"Hours Available",-1))]))])])])])])}}},js=F(Os,[["__scopeId","data-v-437e79e7"]]);export{js as default};
