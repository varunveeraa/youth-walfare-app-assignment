import{r as g,c as h,j as L,a,b as t,f as l,i as T,g as v,t as r,d as f,F as p,D as m,w as V,e as B,s as F,h as H,o as n,y as j}from"./vendor-BmZR9K5F.js";import{_ as q,u as z}from"./index-csEBr71G.js";import{a as J,d as U}from"./useFirestore-Bf5FwK2U.js";import{w}from"./firebase-w6XYyoFK.js";import{R as G}from"./RatingSystem-BsviHeSt.js";import"./mapbox-Dy2hBtBs.js";import"./collections-BIJkFGz0.js";import"./validation-BV3KGR2z.js";const K={class:"rate-counsellor"},O={class:"container"},Q={key:0,class:"center-align"},W={key:1,class:"card-panel red lighten-4 red-text text-darken-2"},X={key:2,class:"row"},Z={class:"col s12"},$={class:"card"},tt={class:"card-content"},et={class:"row"},st={class:"col s12 m4 center-align"},at=["src","alt"],nt={class:"col s12 m8"},ot={class:"appointment-info"},it={class:"chip green lighten-4"},lt={key:3,class:"row"},rt={class:"col s12"},dt={class:"card"},ut={class:"card-content"},ct={key:4,class:"row"},vt={class:"col s12"},pt={class:"card"},mt={class:"card-content"},gt={class:"existing-rating"},_t={class:"stars"},yt={class:"rating-text"},ht={key:0,class:"review-text"},ft={key:1,class:"category-ratings"},wt={class:"category-display"},bt={key:0,class:"category-item"},xt={class:"stars small inline"},Rt={key:1,class:"category-item"},kt={class:"stars small inline"},Dt={key:2,class:"category-item"},St={class:"stars small inline"},At={class:"grey-text"},It={class:"row"},Nt={class:"col s12 center-align"},Ct={__name:"RateCounsellor",setup(Et){const b=F();H();const{user:c}=z(),{getDocument:x,loading:R}=J(),{createRating:k,updateRating:D,getAllRatings:S,loading:A}=U(),o=g(null),s=g(null),d=g(null),I=h(()=>R.value||A.value),N=h(()=>!!s.value),C=async()=>{try{const i=b.params.appointmentId;if(!i){d.value="Appointment ID is required";return}const e=await x(i);if(!e){d.value="Appointment not found";return}if(e.userId!==c.value.uid){d.value="You can only rate your own appointments";return}if(e.status!=="completed"){d.value="You can only rate completed appointments";return}o.value=e,await _()}catch(i){console.error("Error loading appointment:",i),d.value="Failed to load appointment details"}},_=async()=>{try{const i=[w("appointmentId","==",o.value.id),w("userId","==",c.value.uid)],e=await S(i);e.length>0&&(s.value=e[0])}catch(i){console.error("Error loading existing rating:",i)}},E=async i=>{try{const e={...i,userId:c.value.uid,userName:c.value.displayName,appointmentId:o.value.id,createdAt:new Date,updatedAt:new Date};s.value?(await D(s.value.id,{...e,updatedAt:new Date}),M.toast({html:"Rating updated successfully!",classes:"teal"})):(await k(e),M.toast({html:"Rating submitted successfully!",classes:"teal"})),await _()}catch(e){console.error("Error submitting rating:",e),M.toast({html:"Error submitting rating. Please try again.",classes:"red"})}},Y=()=>{s.value=null},y=i=>i?new Date(i).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"";return L(async()=>{await C(),!o.value&&!d.value&&(o.value={id:"mock-appointment-1",counsellorId:"counsellor1",counsellorName:"Dr. Sarah Johnson",counsellorProfilePicture:"https://via.placeholder.com/150x150?text=Dr.+Sarah",userId:c.value.uid,appointmentDate:new Date("2024-01-15T14:00:00"),duration:60,sessionType:"video",status:"completed"})}),(i,e)=>{const P=B("router-link");return n(),a("div",K,[t("div",O,[e[16]||(e[16]=t("div",{class:"row"},[t("div",{class:"col s12"},[t("h4",null,"Rate Your Session"),t("p",{class:"grey-text"},"Help others by sharing your experience with this counsellor.")])],-1)),I.value?(n(),a("div",Q,[...e[0]||(e[0]=[T('<div class="preloader-wrapper active" data-v-d32750ba><div class="spinner-layer spinner-teal-only" data-v-d32750ba><div class="circle-clipper left" data-v-d32750ba><div class="circle" data-v-d32750ba></div></div><div class="gap-patch" data-v-d32750ba><div class="circle" data-v-d32750ba></div></div><div class="circle-clipper right" data-v-d32750ba><div class="circle" data-v-d32750ba></div></div></div></div><p data-v-d32750ba>Loading appointment details...</p>',2)])])):l("",!0),d.value?(n(),a("div",W,[e[1]||(e[1]=t("i",{class:"material-icons left"},"error",-1)),v(" "+r(d.value),1)])):l("",!0),o.value?(n(),a("div",X,[t("div",Z,[t("div",$,[t("div",tt,[e[6]||(e[6]=t("h5",null,"Session Details",-1)),t("div",et,[t("div",st,[t("img",{src:o.value.counsellorProfilePicture||"/api/placeholder/150/150",alt:o.value.counsellorName,class:"circle responsive-img counsellor-avatar"},null,8,at),t("h6",null,r(o.value.counsellorName),1)]),t("div",nt,[t("div",ot,[t("p",null,[e[2]||(e[2]=t("strong",null,"Date:",-1)),v(" "+r(y(o.value.appointmentDate)),1)]),t("p",null,[e[3]||(e[3]=t("strong",null,"Duration:",-1)),v(" "+r(o.value.duration)+" minutes",1)]),t("p",null,[e[4]||(e[4]=t("strong",null,"Session Type:",-1)),v(" "+r(o.value.sessionType),1)]),t("p",null,[e[5]||(e[5]=t("strong",null,"Status:",-1)),t("span",it,r(o.value.status),1)])])])])])])])])):l("",!0),o.value&&!N.value?(n(),a("div",lt,[t("div",rt,[t("div",dt,[t("div",ut,[e[7]||(e[7]=t("h5",null,"Rate Your Experience",-1)),f(G,{mode:"input","show-categories":!0,"counsellor-id":o.value.counsellorId,"appointment-id":o.value.id,onRatingSubmitted:E},null,8,["counsellor-id","appointment-id"])])])])])):l("",!0),s.value?(n(),a("div",ct,[t("div",vt,[t("div",pt,[t("div",mt,[e[13]||(e[13]=t("h5",null,"Your Rating",-1)),e[14]||(e[14]=t("p",{class:"grey-text"},"You have already rated this session.",-1)),t("div",gt,[t("div",_t,[(n(),a(p,null,m(5,u=>t("i",{key:u,class:j(["material-icons star",u<=s.value.rating?"amber-text":"grey-text text-lighten-2"])}," star ",2)),64))]),t("span",yt,r(s.value.rating)+"/5 stars",1)]),s.value.review?(n(),a("div",ht,[e[8]||(e[8]=t("h6",null,"Your Review:",-1)),t("p",null,r(s.value.review),1)])):l("",!0),s.value.communication||s.value.helpfulness||s.value.professionalism?(n(),a("div",ft,[e[12]||(e[12]=t("h6",null,"Category Ratings:",-1)),t("div",wt,[s.value.communication?(n(),a("div",bt,[e[9]||(e[9]=t("span",{class:"category-label"},"Communication:",-1)),t("div",xt,[(n(!0),a(p,null,m(s.value.communication,u=>(n(),a("i",{key:u,class:"material-icons star amber-text"}," star "))),128))])])):l("",!0),s.value.helpfulness?(n(),a("div",Rt,[e[10]||(e[10]=t("span",{class:"category-label"},"Helpfulness:",-1)),t("div",kt,[(n(!0),a(p,null,m(s.value.helpfulness,u=>(n(),a("i",{key:u,class:"material-icons star amber-text"}," star "))),128))])])):l("",!0),s.value.professionalism?(n(),a("div",Dt,[e[11]||(e[11]=t("span",{class:"category-label"},"Professionalism:",-1)),t("div",St,[(n(!0),a(p,null,m(s.value.professionalism,u=>(n(),a("i",{key:u,class:"material-icons star amber-text"}," star "))),128))])])):l("",!0)])])):l("",!0),t("p",At,"Submitted on "+r(y(s.value.createdAt)),1),t("button",{onClick:Y,class:"btn-flat waves-effect waves-teal"}," Edit Rating ")])])])])):l("",!0),t("div",It,[t("div",Nt,[f(P,{to:"/my-appointments",class:"btn-flat waves-effect waves-teal"},{default:V(()=>[...e[15]||(e[15]=[t("i",{class:"material-icons left"},"arrow_back",-1),v(" Back to Appointments ",-1)])]),_:1})])])])])}}},Ht=q(Ct,[["__scopeId","data-v-d32750ba"]]);export{Ht as default};
