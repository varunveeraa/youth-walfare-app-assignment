import{r as w,c as D,j as U,a as n,b as t,f as v,t as a,y as p,u as f,i as P,g as i,F as R,D as F,h as O,o}from"./vendor-BmZR9K5F.js";import{_ as q,u as z}from"./index-csEBr71G.js";import{a as G}from"./useFirestore-Bf5FwK2U.js";import{w as H,x as K}from"./firebase-w6XYyoFK.js";import"./mapbox-Dy2hBtBs.js";import"./collections-BIJkFGz0.js";const Q={class:"counsellor-appointments"},W={class:"container"},X={class:"row"},Y={class:"col s12 m3"},Z={class:"card-panel teal lighten-4 center-align"},ee={class:"teal-text"},te={class:"col s12 m3"},se={class:"card-panel blue lighten-4 center-align"},le={class:"blue-text"},ae={class:"col s12 m3"},ne={class:"card-panel green lighten-4 center-align"},oe={class:"green-text"},ie={class:"col s12 m3"},ce={class:"card-panel orange lighten-4 center-align"},re={class:"orange-text"},de={class:"row"},ue={class:"col s12"},me={class:"tabs"},ve={class:"tab col s3"},pe={class:"tab col s3"},ge={class:"tab col s3"},fe={class:"tab col s3"},he={key:0,class:"center-align"},_e={key:1,class:"card-panel red lighten-4 red-text"},be={class:"row"},ye={class:"col s12"},we={key:0,class:"center-align"},De={class:"grey-text"},Ae={key:1},ke={class:"card-content"},Ce={class:"row"},xe={class:"col s12 m3"},Ne={class:"client-info"},Te=["src","alt"],Se={class:"client-details"},$e={class:"client-name"},Me={class:"grey-text"},Ie={class:"col s12 m6"},Ve={class:"appointment-details"},Be={key:0,class:"notes"},Ee={class:"col s12 m3"},je={class:"appointment-status"},Je={class:"material-icons left tiny"},Le={class:"appointment-actions"},Ue={key:0},Pe=["onClick"],Re=["onClick"],Fe=["onClick"],Oe={key:1},qe=["onClick"],ze={__name:"CounsellorAppointments",setup(Ge){O();const{user:A}=z(),{getAllAppointments:k,updateAppointment:C,loading:_,error:h}=G(),u=w([]),c=w("all"),b=D(()=>{let s=u.value;switch(c.value){case"upcoming":s=s.filter(e=>e.status==="scheduled");break;case"completed":s=s.filter(e=>e.status==="completed");break;case"cancelled":s=s.filter(e=>e.status==="cancelled");break}return s.sort((e,l)=>new Date(l.appointmentDate)-new Date(e.appointmentDate))}),r=D(()=>{const s=u.value.length,e=u.value.filter(d=>d.status==="scheduled").length,l=u.value.filter(d=>d.status==="completed").length,m=u.value.filter(d=>d.status==="cancelled").length;return{total:s,upcoming:e,completed:l,cancelled:m}}),y=async()=>{try{const s=[H("counsellorId","==",A.value.uid),K("appointmentDate","desc")],e=await k(s);u.value=e.map(l=>({...l,appointmentDate:l.appointmentDate?.toDate?l.appointmentDate.toDate():new Date(l.appointmentDate),createdAt:l.createdAt?.toDate?l.createdAt.toDate():new Date(l.createdAt),updatedAt:l.updatedAt?.toDate?l.updatedAt.toDate():new Date(l.updatedAt)}))}catch(s){h.value=s.message}},g=s=>{c.value=s},x=s=>s.userName?s.userName.trim()||s.userEmail?.split("@")[0]||"Client":"Anonymous Client",N=s=>{if(!s)return"No date";const e=s.toDate?s.toDate():new Date(s);return isNaN(e.getTime())?"Invalid date":e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},T=s=>{if(!s)return"No time";const e=s.toDate?s.toDate():new Date(s);return isNaN(e.getTime())?"Invalid time":e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})},S=s=>({video:"Video Call",audio:"Audio Call",chat:"Text Chat","in-person":"In-Person"})[s]||s,$=s=>({scheduled:"Scheduled",completed:"Completed",cancelled:"Cancelled","no-show":"No Show"})[s]||s,I=s=>{switch(s){case"scheduled":return"blue lighten-4 blue-text";case"completed":return"green lighten-4 green-text";case"cancelled":return"red lighten-4 red-text";case"no-show":return"orange lighten-4 orange-text";default:return"grey lighten-4 grey-text"}},V=s=>{switch(s){case"scheduled":return"schedule";case"completed":return"check_circle";case"cancelled":return"cancel";case"no-show":return"person_off";default:return"help"}},B=s=>{const e=new Date,d=(new Date(s.appointmentDate).getTime()-e.getTime())/(1e3*60);return d<=15&&d>=-30},E=s=>{M.toast({html:"Joining session...",classes:"blue"}),alert(`Joining ${s.sessionType} session with ${s.userName}`)},j=s=>{M.toast({html:"Reschedule functionality coming soon",classes:"blue"})},J=async s=>{if(confirm(`Are you sure you want to cancel the appointment with ${s.userName}?`))try{await C(s.id,{status:"cancelled",cancelledAt:new Date,cancelledBy:"counsellor"}),await y(),M.toast({html:"Appointment cancelled successfully",classes:"orange"})}catch{M.toast({html:"Error cancelling appointment",classes:"red"})}},L=s=>{M.toast({html:"Notes functionality coming soon",classes:"blue"})};return U(async()=>{M.Tabs.init(document.querySelectorAll(".tabs")),await y()}),(s,e)=>(o(),n("div",Q,[t("div",W,[e[24]||(e[24]=t("div",{class:"row"},[t("div",{class:"col s12"},[t("h4",null,"My Appointments"),t("p",{class:"grey-text"},"View and manage your scheduled appointments with clients.")])],-1)),t("div",X,[t("div",Y,[t("div",Z,[e[4]||(e[4]=t("i",{class:"material-icons large teal-text"},"event",-1)),t("h5",ee,a(r.value.total),1),e[5]||(e[5]=t("p",null,"Total Appointments",-1))])]),t("div",te,[t("div",se,[e[6]||(e[6]=t("i",{class:"material-icons large blue-text"},"schedule",-1)),t("h5",le,a(r.value.upcoming),1),e[7]||(e[7]=t("p",null,"Upcoming",-1))])]),t("div",ae,[t("div",ne,[e[8]||(e[8]=t("i",{class:"material-icons large green-text"},"check_circle",-1)),t("h5",oe,a(r.value.completed),1),e[9]||(e[9]=t("p",null,"Completed",-1))])]),t("div",ie,[t("div",ce,[e[10]||(e[10]=t("i",{class:"material-icons large orange-text"},"cancel",-1)),t("h5",re,a(r.value.cancelled),1),e[11]||(e[11]=t("p",null,"Cancelled",-1))])])]),t("div",de,[t("div",ue,[t("ul",me,[t("li",ve,[t("a",{href:"#all",class:p({active:c.value==="all"}),onClick:e[0]||(e[0]=l=>g("all"))}," All ("+a(r.value.total)+") ",3)]),t("li",pe,[t("a",{href:"#upcoming",class:p({active:c.value==="upcoming"}),onClick:e[1]||(e[1]=l=>g("upcoming"))}," Upcoming ("+a(r.value.upcoming)+") ",3)]),t("li",ge,[t("a",{href:"#completed",class:p({active:c.value==="completed"}),onClick:e[2]||(e[2]=l=>g("completed"))}," Completed ("+a(r.value.completed)+") ",3)]),t("li",fe,[t("a",{href:"#cancelled",class:p({active:c.value==="cancelled"}),onClick:e[3]||(e[3]=l=>g("cancelled"))}," Cancelled ("+a(r.value.cancelled)+") ",3)])])])]),f(_)?(o(),n("div",he,[...e[12]||(e[12]=[P('<div class="preloader-wrapper big active" data-v-7f7b76fa><div class="spinner-layer spinner-blue-only" data-v-7f7b76fa><div class="circle-clipper left" data-v-7f7b76fa><div class="circle" data-v-7f7b76fa></div></div><div class="gap-patch" data-v-7f7b76fa><div class="circle" data-v-7f7b76fa></div></div><div class="circle-clipper right" data-v-7f7b76fa><div class="circle" data-v-7f7b76fa></div></div></div></div><p data-v-7f7b76fa>Loading appointments...</p>',2)])])):v("",!0),f(h)?(o(),n("div",_e,[e[13]||(e[13]=t("i",{class:"material-icons left"},"error",-1)),i(" Error loading appointments: "+a(f(h)),1)])):v("",!0),t("div",be,[t("div",ye,[b.value.length===0&&!f(_)?(o(),n("div",we,[e[14]||(e[14]=t("i",{class:"material-icons large grey-text"},"event_busy",-1)),t("p",De,"No "+a(c.value==="all"?"":c.value)+" appointments found.",1),e[15]||(e[15]=t("p",{class:"grey-text"},"Appointments will appear here when clients book sessions with you.",-1))])):(o(),n("div",Ae,[(o(!0),n(R,null,F(b.value,l=>(o(),n("div",{key:l.id,class:"card appointment-card"},[t("div",ke,[t("div",Ce,[t("div",xe,[t("div",Ne,[t("img",{src:l.userProfilePicture||"/api/placeholder/60/60",alt:l.userName,class:"circle responsive-img client-avatar"},null,8,Te),t("div",Se,[t("h6",$e,a(x(l)),1),t("p",Me,a(l.userEmail||"No email provided"),1)])])]),t("div",Ie,[t("div",Ve,[t("h6",null,[e[16]||(e[16]=t("i",{class:"material-icons left tiny"},"event",-1)),i(" "+a(N(l.appointmentDate)),1)]),t("p",null,[e[17]||(e[17]=t("i",{class:"material-icons left tiny"},"schedule",-1)),i(" "+a(T(l.appointmentDate))+" ("+a(l.duration||60)+" minutes) ",1)]),t("p",null,[e[18]||(e[18]=t("i",{class:"material-icons left tiny"},"videocam",-1)),i(" "+a(S(l.sessionType)),1)]),l.userNotes?(o(),n("p",Be,[e[19]||(e[19]=t("i",{class:"material-icons left tiny"},"note",-1)),i(" "+a(l.userNotes),1)])):v("",!0)])]),t("div",Ee,[t("div",je,[t("span",{class:p(["chip",I(l.status)])},[t("i",Je,a(V(l.status)),1),i(" "+a($(l.status)),1)],2),t("div",Le,[l.status==="scheduled"?(o(),n("div",Ue,[B(l)?(o(),n("button",{key:0,onClick:m=>E(l),class:"btn green waves-effect waves-light btn-small"},[...e[20]||(e[20]=[t("i",{class:"material-icons left"},"videocam",-1),i(" Join Session ",-1)])],8,Pe)):v("",!0),t("button",{onClick:m=>j(),class:"btn blue waves-effect waves-light btn-small"},[...e[21]||(e[21]=[t("i",{class:"material-icons left"},"schedule",-1),i(" Reschedule ",-1)])],8,Re),t("button",{onClick:m=>J(l),class:"btn red waves-effect waves-light btn-small"},[...e[22]||(e[22]=[t("i",{class:"material-icons left"},"cancel",-1),i(" Cancel ",-1)])],8,Fe)])):v("",!0),l.status==="completed"?(o(),n("div",Oe,[t("button",{onClick:m=>L(),class:"btn blue waves-effect waves-light btn-small"},[...e[23]||(e[23]=[t("i",{class:"material-icons left"},"note_add",-1),i(" Add Notes ",-1)])],8,qe)])):v("",!0)])])])])])]))),128))]))])])])]))}},Ze=q(ze,[["__scopeId","data-v-7f7b76fa"]]);export{Ze as default};
