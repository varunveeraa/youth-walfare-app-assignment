import{r as R,q as U,c as $,j as oe,a as c,b as e,i as x,u as ne,g as v,v as p,z as L,F as w,D,x as Q,t as f,E as g,f as S,o as u}from"./vendor-BmZR9K5F.js";import{_ as re,u as de,d as y}from"./index-csEBr71G.js";import{c as ce}from"./useFirestore-Bf5FwK2U.js";import{m as ue,n as T,A,z as h,w as C,B,t as N,D as P}from"./firebase-w6XYyoFK.js";import"./mapbox-Dy2hBtBs.js";import"./collections-BIJkFGz0.js";const ve={class:"counsellor-availability"},me={class:"container"},pe={key:0,class:"row"},be={key:1},fe={class:"row"},ye={class:"col s12"},ge={class:"card"},ke={class:"card-content"},Te={class:"row"},he={class:"input-field col s12 m6"},Se=["value"],_e={class:"input-field col s12 m6"},we={class:"row"},De={class:"col s12 m6"},Ae={class:"switch"},Ce={class:"grey-text"},Be={class:"col s12 m6"},Ee={class:"input-field"},Me={class:"row"},Ve={class:"col s12"},Ue={class:"card"},xe={class:"card-content"},Ne={class:"schedule-grid"},Oe={class:"day-header"},We={class:"day-toggle"},ze=["onUpdate:modelValue","onChange"],qe={class:"day-name"},Fe={key:0,class:"time-slots"},He={class:"time-inputs"},Re={class:"input-field"},$e=["onUpdate:modelValue","onChange"],Le={class:"input-field"},Qe=["onUpdate:modelValue","onChange"],Pe=["onClick"],Ye={key:0,class:"error-text"},Ge=["onClick"],Ie={key:1,class:"unavailable-day"},je={class:"grey-text center-align"},Je={class:"row"},Ke={class:"col s12"},Xe={class:"card"},Ze={class:"card-content"},et={class:"breaks-section"},tt={key:0,class:"breaks-list"},at={class:"row valign-wrapper"},st={class:"col s8"},lt={class:"grey-text"},it={key:0},ot={key:0,class:"break-reason"},nt={class:"grey-text"},rt={class:"col s4 right-align"},dt=["onClick"],ct={class:"add-break-form"},ut={class:"row"},vt={class:"input-field col s12 m6"},mt={class:"input-field col s12 m3"},pt=["min"],bt={class:"input-field col s12 m3"},ft=["min"],yt={class:"row"},gt={class:"input-field col s12 m8"},kt={class:"col s12 m4"},Tt=["disabled"],ht={class:"row"},St={class:"col s12 center-align"},_t=["disabled"],wt={__name:"CounsellorAvailability",setup(Dt){const{user:b}=de(),{loading:Y}=ce(),_=R(!1),m=U({timezone:"America/New_York",sessionDuration:60,acceptingNewClients:!0,advanceBookingDays:14}),O=[{name:"Sunday",short:"Sun"},{name:"Monday",short:"Mon"},{name:"Tuesday",short:"Tue"},{name:"Wednesday",short:"Wed"},{name:"Thursday",short:"Thu"},{name:"Friday",short:"Fri"},{name:"Saturday",short:"Sat"}],o=U(O.map(()=>({isAvailable:!1,timeSlots:[{startTime:"09:00",endTime:"17:00",error:null}]}))),k=R([]),n=U({title:"",startDate:"",endDate:"",reason:""}),G=[{value:"America/New_York",label:"Eastern Time (ET)"},{value:"America/Chicago",label:"Central Time (CT)"},{value:"America/Denver",label:"Mountain Time (MT)"},{value:"America/Los_Angeles",label:"Pacific Time (PT)"},{value:"America/Anchorage",label:"Alaska Time (AKT)"},{value:"Pacific/Honolulu",label:"Hawaii Time (HT)"},{value:"UTC",label:"UTC"},{value:"Europe/London",label:"Greenwich Mean Time (GMT)"},{value:"Europe/Paris",label:"Central European Time (CET)"},{value:"Asia/Tokyo",label:"Japan Standard Time (JST)"},{value:"Australia/Sydney",label:"Australian Eastern Time (AET)"}],W=$(()=>new Date().toISOString().split("T")[0]),z=$(()=>n.title.trim()&&n.startDate),q=async()=>{if(b.value?.uid)try{const s=await ue(T(y,"counsellorSettings",b.value.uid));s.exists()&&Object.assign(m,s.data());const t=A(h(y,"availability"),C("counsellorId","==",b.value.uid)),a=await B(t);o.forEach(l=>{l.isAvailable=!1,l.timeSlots=[{startTime:"09:00",endTime:"17:00",error:null}]}),a.forEach(l=>{const d=l.data();d.dayOfWeek>=0&&d.dayOfWeek<=6&&(o[d.dayOfWeek].isAvailable=d.isAvailable,d.timeSlots&&d.timeSlots.length>0&&(o[d.dayOfWeek].timeSlots=d.timeSlots.map(V=>({...V,error:null}))))});const r=A(h(y,"counsellorBreaks"),C("counsellorId","==",b.value.uid)),i=await B(r);k.value=i.docs.map(l=>({id:l.id,...l.data()}))}catch(s){console.error("Error loading availability:",s),M.toast({html:"Error loading availability: "+s.message,classes:"red"})}},I=s=>{o[s].isAvailable||(o[s].timeSlots=[{startTime:"09:00",endTime:"17:00",error:null}])},j=s=>{o[s].timeSlots.push({startTime:"09:00",endTime:"17:00",error:null})},J=(s,t)=>{o[s].timeSlots.length>1&&o[s].timeSlots.splice(t,1)},E=(s,t)=>{const a=o[s].timeSlots[t];if(!a.startTime||!a.endTime)return a.error="Both start and end times are required",!1;if(a.startTime>=a.endTime)return a.error="End time must be after start time",!1;const r=o[s].timeSlots.filter((i,l)=>l!==t);for(const i of r)if(a.startTime>=i.startTime&&a.startTime<i.endTime||a.endTime>i.startTime&&a.endTime<=i.endTime||a.startTime<=i.startTime&&a.endTime>=i.endTime)return a.error="Time slots cannot overlap",!1;return a.error=null,!0},K=()=>{if(!z.value)return;const s={title:n.title.trim(),startDate:n.startDate,endDate:n.endDate||n.startDate,reason:n.reason.trim(),counsellorId:b.value.uid,createdAt:new Date};k.value.push(s),n.title="",n.startDate="",n.endDate="",n.reason=""},X=s=>{k.value.splice(s,1)},F=s=>new Date(s).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),Z=()=>{M.toast({html:"Previous week schedule copied!",classes:"blue"})},ee=()=>{for(let s=1;s<=5;s++)o[s].isAvailable=!0,o[s].timeSlots=[{startTime:"09:00",endTime:"17:00",error:null}];o[0].isAvailable=!1,o[6].isAvailable=!1,M.toast({html:"Standard business hours set (Mon-Fri 9-5)!",classes:"green"})},te=()=>{o.forEach(s=>{s.isAvailable=!1,s.timeSlots=[{startTime:"09:00",endTime:"17:00",error:null}]}),M.toast({html:"All schedule cleared!",classes:"orange"})},ae=()=>{let s=!0;return o.forEach((t,a)=>{t.isAvailable&&t.timeSlots.forEach((r,i)=>{E(a,i)||(s=!1)})}),s},se=async()=>{if(!ae()){M.toast({html:"Please fix time slot errors before saving",classes:"red"});return}_.value=!0;try{await N(T(y,"counsellorSettings",b.value.uid),{...m,updatedAt:new Date});const s=[],t=A(h(y,"availability"),C("counsellorId","==",b.value.uid)),a=await B(t);for(const l of a.docs)await P(T(y,"availability",l.id));for(let l=0;l<o.length;l++){const d=o[l];if(d.isAvailable){const V={counsellorId:b.value.uid,dayOfWeek:l,isAvailable:!0,timeSlots:d.timeSlots.map(H=>({startTime:H.startTime,endTime:H.endTime})),timezone:m.timezone,createdAt:new Date,updatedAt:new Date},ie=T(h(y,"availability"));await N(ie,V)}}const r=A(h(y,"counsellorBreaks"),C("counsellorId","==",b.value.uid)),i=await B(r);for(const l of i.docs)await P(T(y,"counsellorBreaks",l.id));for(const l of k.value)if(!l.id){const d=T(h(y,"counsellorBreaks"));await N(d,{...l,counsellorId:b.value.uid,createdAt:new Date})}M.toast({html:"Availability saved successfully!",classes:"green"})}catch(s){console.error("Error saving availability:",s),M.toast({html:"Error saving availability: "+s.message,classes:"red"})}finally{_.value=!1}},le=()=>{q(),M.toast({html:"Changes reset!",classes:"blue"})};return oe(async()=>{await q(),setTimeout(()=>{M.FormSelect.init(document.querySelectorAll("select"))},100)}),(s,t)=>(u(),c("div",ve,[e("div",me,[t[46]||(t[46]=x('<div class="row" data-v-c9f6a8ad><div class="col s12" data-v-c9f6a8ad><div class="card-panel blue lighten-5" data-v-c9f6a8ad><h4 class="blue-text" data-v-c9f6a8ad>Availability Management</h4><p class="grey-text text-darken-1" data-v-c9f6a8ad> Set your weekly schedule and manage your availability for client appointments. </p></div></div></div>',1)),ne(Y)?(u(),c("div",pe,[...t[8]||(t[8]=[x('<div class="col s12 center-align" data-v-c9f6a8ad><div class="preloader-wrapper big active" data-v-c9f6a8ad><div class="spinner-layer spinner-blue-only" data-v-c9f6a8ad><div class="circle-clipper left" data-v-c9f6a8ad><div class="circle" data-v-c9f6a8ad></div></div><div class="gap-patch" data-v-c9f6a8ad><div class="circle" data-v-c9f6a8ad></div></div><div class="circle-clipper right" data-v-c9f6a8ad><div class="circle" data-v-c9f6a8ad></div></div></div></div><p data-v-c9f6a8ad>Loading your availability...</p></div>',1)])])):(u(),c("div",be,[e("div",fe,[e("div",ye,[e("div",ge,[e("div",ke,[t[21]||(t[21]=e("span",{class:"card-title"},[e("i",{class:"material-icons left"},"schedule"),v(" General Settings ")],-1)),e("div",Te,[e("div",he,[t[10]||(t[10]=e("i",{class:"material-icons prefix"},"public",-1)),p(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>m.timezone=a),required:""},[t[9]||(t[9]=e("option",{value:"",disabled:""},"Choose your timezone",-1)),(u(),c(w,null,D(G,a=>e("option",{key:a.value,value:a.value},f(a.label),9,Se)),64))],512),[[L,m.timezone]]),t[11]||(t[11]=e("label",null,"Timezone",-1))]),e("div",_e,[t[13]||(t[13]=e("i",{class:"material-icons prefix"},"timer",-1)),p(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>m.sessionDuration=a),required:""},[...t[12]||(t[12]=[x('<option value="" disabled data-v-c9f6a8ad>Session duration</option><option value="30" data-v-c9f6a8ad>30 minutes</option><option value="45" data-v-c9f6a8ad>45 minutes</option><option value="60" data-v-c9f6a8ad>60 minutes</option><option value="90" data-v-c9f6a8ad>90 minutes</option>',5)])],512),[[L,m.sessionDuration]]),t[14]||(t[14]=e("label",null,"Default Session Duration",-1))])]),e("div",we,[e("div",De,[e("div",Ae,[e("label",null,[t[15]||(t[15]=v(" Unavailable ",-1)),p(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=a=>m.acceptingNewClients=a)},null,512),[[Q,m.acceptingNewClients]]),t[16]||(t[16]=e("span",{class:"lever"},null,-1)),t[17]||(t[17]=v(" Accepting New Clients ",-1))])]),e("p",Ce,f(m.acceptingNewClients?"You are currently accepting new client bookings":"You are not accepting new client bookings"),1)]),e("div",Be,[e("div",Ee,[t[18]||(t[18]=e("i",{class:"material-icons prefix"},"event_busy",-1)),p(e("input",{id:"advanceBooking",type:"number","onUpdate:modelValue":t[3]||(t[3]=a=>m.advanceBookingDays=a),min:"1",max:"90"},null,512),[[g,m.advanceBookingDays,void 0,{number:!0}]]),t[19]||(t[19]=e("label",{for:"advanceBooking"},"Advance Booking (days)",-1)),t[20]||(t[20]=e("span",{class:"helper-text"},"How far in advance clients can book",-1))])])])])])])]),e("div",Me,[e("div",Ve,[e("div",Ue,[e("div",xe,[t[27]||(t[27]=e("span",{class:"card-title"},[e("i",{class:"material-icons left"},"date_range"),v(" Weekly Schedule ")],-1)),t[28]||(t[28]=e("p",{class:"grey-text"},"Set your available hours for each day of the week",-1)),e("div",Ne,[(u(),c(w,null,D(O,(a,r)=>e("div",{key:a.name,class:"day-schedule"},[e("div",Oe,[e("div",We,[e("label",null,[p(e("input",{type:"checkbox","onUpdate:modelValue":i=>o[r].isAvailable=i,onChange:i=>I(r)},null,40,ze),[[Q,o[r].isAvailable]]),e("span",qe,f(a.name),1)])])]),o[r].isAvailable?(u(),c("div",Fe,[(u(!0),c(w,null,D(o[r].timeSlots,(i,l)=>(u(),c("div",{key:l,class:"time-slot"},[e("div",He,[e("div",Re,[p(e("input",{type:"time","onUpdate:modelValue":d=>i.startTime=d,onChange:d=>E(r,l)},null,40,$e),[[g,i.startTime]]),t[22]||(t[22]=e("label",{class:"active"},"Start Time",-1))]),t[25]||(t[25]=e("span",{class:"time-separator"},"to",-1)),e("div",Le,[p(e("input",{type:"time","onUpdate:modelValue":d=>i.endTime=d,onChange:d=>E(r,l)},null,40,Qe),[[g,i.endTime]]),t[23]||(t[23]=e("label",{class:"active"},"End Time",-1))]),o[r].timeSlots.length>1?(u(),c("button",{key:0,type:"button",onClick:d=>J(r,l),class:"btn-small red"},[...t[24]||(t[24]=[e("i",{class:"material-icons"},"delete",-1)])],8,Pe)):S("",!0)]),i.error?(u(),c("div",Ye,f(i.error),1)):S("",!0)]))),128)),e("button",{type:"button",onClick:i=>j(r),class:"btn-small blue",style:{"margin-top":"1rem"}},[...t[26]||(t[26]=[e("i",{class:"material-icons left"},"add",-1),v(" Add Time Slot ",-1)])],8,Ge)])):(u(),c("div",Ie,[e("p",je,"Not available on "+f(a.name),1)]))])),64))])])])])]),e("div",Je,[e("div",Ke,[e("div",Xe,[e("div",Ze,[t[38]||(t[38]=e("span",{class:"card-title"},[e("i",{class:"material-icons left"},"free_breakfast"),v(" Breaks & Unavailable Periods ")],-1)),t[39]||(t[39]=e("p",{class:"grey-text"},"Set specific dates when you'll be unavailable",-1)),e("div",et,[k.value.length>0?(u(),c("div",tt,[t[31]||(t[31]=e("h6",null,"Scheduled Breaks",-1)),(u(!0),c(w,null,D(k.value,(a,r)=>(u(),c("div",{key:r,class:"break-item card-panel grey lighten-4"},[e("div",at,[e("div",st,[e("strong",null,f(a.title),1),t[29]||(t[29]=e("br",null,null,-1)),e("span",lt,[v(f(F(a.startDate))+" ",1),a.endDate&&a.startDate!==a.endDate?(u(),c("span",it," to "+f(F(a.endDate)),1)):S("",!0)]),a.reason?(u(),c("div",ot,[e("small",nt,f(a.reason),1)])):S("",!0)]),e("div",rt,[e("button",{type:"button",onClick:i=>X(r),class:"btn-small red"},[...t[30]||(t[30]=[e("i",{class:"material-icons"},"delete",-1)])],8,dt)])])]))),128))])):S("",!0),e("div",ct,[t[37]||(t[37]=e("h6",null,"Add New Break",-1)),e("div",ut,[e("div",vt,[p(e("input",{id:"breakTitle",type:"text","onUpdate:modelValue":t[4]||(t[4]=a=>n.title=a),placeholder:"e.g., Vacation, Conference, Personal Day"},null,512),[[g,n.title]]),t[32]||(t[32]=e("label",{for:"breakTitle"},"Break Title",-1))]),e("div",mt,[p(e("input",{id:"breakStartDate",type:"date","onUpdate:modelValue":t[5]||(t[5]=a=>n.startDate=a),min:W.value},null,8,pt),[[g,n.startDate]]),t[33]||(t[33]=e("label",{for:"breakStartDate",class:"active"},"Start Date",-1))]),e("div",bt,[p(e("input",{id:"breakEndDate",type:"date","onUpdate:modelValue":t[6]||(t[6]=a=>n.endDate=a),min:n.startDate||W.value},null,8,ft),[[g,n.endDate]]),t[34]||(t[34]=e("label",{for:"breakEndDate",class:"active"},"End Date (Optional)",-1))])]),e("div",yt,[e("div",gt,[p(e("textarea",{id:"breakReason",class:"materialize-textarea","onUpdate:modelValue":t[7]||(t[7]=a=>n.reason=a),placeholder:"Optional reason for the break"},null,512),[[g,n.reason]]),t[35]||(t[35]=e("label",{for:"breakReason"},"Reason (Optional)",-1))]),e("div",kt,[e("button",{type:"button",onClick:K,class:"btn blue",disabled:!z.value,style:{"margin-top":"1rem"}},[...t[36]||(t[36]=[e("i",{class:"material-icons left"},"add",-1),v(" Add Break ",-1)])],8,Tt)])])])])])])])]),e("div",{class:"row"},[e("div",{class:"col s12"},[e("div",{class:"card"},[e("div",{class:"card-content"},[t[43]||(t[43]=e("span",{class:"card-title"},[e("i",{class:"material-icons left"},"flash_on"),v(" Quick Actions ")],-1)),e("div",{class:"quick-actions"},[e("button",{type:"button",onClick:Z,class:"btn blue"},[...t[40]||(t[40]=[e("i",{class:"material-icons left"},"content_copy",-1),v(" Copy Previous Week ",-1)])]),e("button",{type:"button",onClick:ee,class:"btn green"},[...t[41]||(t[41]=[e("i",{class:"material-icons left"},"schedule",-1),v(" Set Standard Hours (9-5) ",-1)])]),e("button",{type:"button",onClick:te,class:"btn orange"},[...t[42]||(t[42]=[e("i",{class:"material-icons left"},"clear_all",-1),v(" Clear All ",-1)])])])])])])]),e("div",ht,[e("div",St,[e("button",{type:"button",onClick:se,class:"btn-large blue waves-effect waves-light",disabled:_.value},[t[44]||(t[44]=e("i",{class:"material-icons left"},"save",-1)),v(" "+f(_.value?"Saving...":"Save Availability"),1)],8,_t),e("button",{type:"button",onClick:le,class:"btn-large grey waves-effect waves-light",style:{"margin-left":"1rem"}},[...t[45]||(t[45]=[e("i",{class:"material-icons left"},"refresh",-1),v(" Reset Changes ",-1)])])])])]))])]))}},Ut=re(wt,[["__scopeId","data-v-c9f6a8ad"]]);export{Ut as default};
