import{r as k,c as U,j as F,a as n,b as t,f as u,y as v,u as p,i as J,g as c,t as o,d as A,w as C,e as q,F as g,D as z,h as Y,o as i}from"./vendor-BmZR9K5F.js";import{_ as G,u as H}from"./index-csEBr71G.js";import{a as K}from"./useFirestore-Bf5FwK2U.js";import{w as O,x as Q}from"./firebase-w6XYyoFK.js";import"./mapbox-Dy2hBtBs.js";import"./collections-BIJkFGz0.js";const W={class:"my-appointments"},X={class:"container"},Z={class:"row"},ee={class:"col s12"},te={class:"tabs"},se={class:"tab col s3"},ae={class:"tab col s3"},le={class:"tab col s3"},oe={class:"tab col s3"},ne={key:0,class:"center-align"},ie={key:1,class:"card-panel red lighten-4 red-text text-darken-2"},ce={class:"row"},re={class:"col s12"},de={key:0,class:"center-align"},ue={class:"grey-text"},ve={class:"card-content"},me={class:"row"},pe={class:"col s12 m3 center-align"},fe={key:0,class:"profile-image-container"},ge=["src","alt"],he={key:1,class:"profile-placeholder circle counsellor-avatar"},_e={class:"avatar-initials"},ye={class:"col s12 m6"},De={class:"appointment-details"},we={key:0},be={class:"col s12 m3 center-align"},ke={class:"appointment-status"},Ae={class:"material-icons left tiny"},Ce={class:"appointment-actions"},Ne=["onClick","disabled"],Te=["onClick"],Se=["onClick"],xe=["onClick"],Ie=["onClick"],$e={__name:"MyAppointments",setup(Me){const N=Y(),{user:T}=H(),{getAllAppointments:S,updateAppointment:x,loading:h,error:f}=K(),_=k([]),r=k("all"),y=U(()=>{let s=_.value;switch(r.value){case"upcoming":s=s.filter(e=>e.status==="scheduled");break;case"completed":s=s.filter(e=>e.status==="completed");break;case"cancelled":s=s.filter(e=>e.status==="cancelled");break}return s.sort((e,l)=>new Date(l.appointmentDate)-new Date(e.appointmentDate))}),D=async()=>{try{const s=[O("userId","==",T.value.uid),Q("appointmentDate","desc")],e=await S(s);_.value=e.map(l=>({...l,appointmentDate:l.appointmentDate?.toDate?l.appointmentDate.toDate():new Date(l.appointmentDate),createdAt:l.createdAt?.toDate?l.createdAt.toDate():new Date(l.createdAt),updatedAt:l.updatedAt?.toDate?l.updatedAt.toDate():new Date(l.updatedAt)}))}catch(s){f.value=s.message}},m=s=>{r.value=s},I=s=>{if(!s)return"Invalid Date";try{const e=s?.toDate?s.toDate():new Date(s);return isNaN(e.getTime())?"Invalid Date":e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return"Invalid Date"}},$=s=>{if(!s)return"Invalid Date";try{const e=s?.toDate?s.toDate():new Date(s);return isNaN(e.getTime())?"Invalid Date":e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}catch(e){return console.error("Error formatting time:",e),"Invalid Date"}},B=s=>{switch(s){case"scheduled":return"blue lighten-4";case"completed":return"green lighten-4";case"cancelled":return"red lighten-4";default:return"grey lighten-4"}},j=s=>{switch(s){case"scheduled":return"schedule";case"completed":return"check_circle";case"cancelled":return"cancel";default:return"help"}},w=s=>{const e=new Date,d=(new Date(s.appointmentDate).getTime()-e.getTime())/(1e3*60);return d<=15&&d>=-30},E=s=>{M.toast({html:"Joining session...",classes:"teal"}),setTimeout(()=>{M.toast({html:"Session joined successfully!",classes:"green"})},2e3)},V=s=>{M.toast({html:"Reschedule feature coming soon!",classes:"blue"})},L=async s=>{if(confirm("Are you sure you want to cancel this appointment?"))try{await x(s.id,{status:"cancelled",cancelledAt:new Date,cancelledBy:"user"}),await D(),M.toast({html:"Appointment cancelled successfully",classes:"orange"})}catch{M.toast({html:"Error cancelling appointment",classes:"red"})}},b=s=>{N.push({path:"/counsellors",query:{counsellorId:s.counsellorId}})},R=s=>s?s.split(" ").map(e=>e.charAt(0).toUpperCase()).slice(0,2).join(""):"?",P=s=>{s.target.style.display="none";const e=s.target.closest(".profile-image-container");if(e){e.style.display="none";const l=e.nextElementSibling;l&&l.classList.contains("profile-placeholder")&&(l.style.display="flex")}};return F(async()=>{M.Tabs.init(document.querySelectorAll(".tabs")),await D()}),(s,e)=>{const l=q("router-link");return i(),n("div",W,[t("div",X,[e[16]||(e[16]=t("div",{class:"row"},[t("div",{class:"col s12"},[t("h4",null,"My Appointments"),t("p",{class:"grey-text"},"View and manage your scheduled sessions with counsellors.")])],-1)),t("div",Z,[t("div",ee,[t("ul",te,[t("li",se,[t("a",{href:"#all",class:v({active:r.value==="all"}),onClick:e[0]||(e[0]=a=>m("all"))}," All ",2)]),t("li",ae,[t("a",{href:"#upcoming",class:v({active:r.value==="upcoming"}),onClick:e[1]||(e[1]=a=>m("upcoming"))}," Upcoming ",2)]),t("li",le,[t("a",{href:"#completed",class:v({active:r.value==="completed"}),onClick:e[2]||(e[2]=a=>m("completed"))}," Completed ",2)]),t("li",oe,[t("a",{href:"#cancelled",class:v({active:r.value==="cancelled"}),onClick:e[3]||(e[3]=a=>m("cancelled"))}," Cancelled ",2)])])])]),p(h)?(i(),n("div",ne,[...e[4]||(e[4]=[J('<div class="preloader-wrapper active" data-v-66934d1b><div class="spinner-layer spinner-teal-only" data-v-66934d1b><div class="circle-clipper left" data-v-66934d1b><div class="circle" data-v-66934d1b></div></div><div class="gap-patch" data-v-66934d1b><div class="circle" data-v-66934d1b></div></div><div class="circle-clipper right" data-v-66934d1b><div class="circle" data-v-66934d1b></div></div></div></div><p data-v-66934d1b>Loading appointments...</p>',2)])])):u("",!0),p(f)?(i(),n("div",ie,[e[5]||(e[5]=t("i",{class:"material-icons left"},"error",-1)),c(" "+o(p(f)),1)])):u("",!0),t("div",ce,[t("div",re,[y.value.length===0&&!p(h)?(i(),n("div",de,[e[7]||(e[7]=t("i",{class:"material-icons large grey-text"},"event_busy",-1)),t("p",ue,"No "+o(r.value==="all"?"":r.value)+" appointments found.",1),A(l,{to:"/counsellors",class:"btn waves-effect waves-light teal"},{default:C(()=>[...e[6]||(e[6]=[t("i",{class:"material-icons left"},"add",-1),c(" Find Your Counsellor ",-1)])]),_:1})])):u("",!0),(i(!0),n(g,null,z(y.value,a=>(i(),n("div",{key:a.id,class:"card appointment-card"},[t("div",ve,[t("div",me,[t("div",pe,[a.counsellorProfilePicture?(i(),n("div",fe,[t("img",{src:a.counsellorProfilePicture,alt:a.counsellorName,class:"circle responsive-img counsellor-avatar",onError:P},null,40,ge)])):(i(),n("div",he,[t("div",_e,o(R(a.counsellorName)),1)])),t("h6",null,o(a.counsellorName),1)]),t("div",ye,[t("div",De,[t("h6",null,o(I(a.appointmentDate)),1),t("p",null,[e[8]||(e[8]=t("strong",null,"Time:",-1)),c(" "+o($(a.appointmentDate)),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"Duration:",-1)),c(" "+o(a.duration)+" minutes",1)]),t("p",null,[e[10]||(e[10]=t("strong",null,"Session Type:",-1)),c(" "+o(a.sessionType),1)]),t("p",null,[e[11]||(e[11]=t("strong",null,"Cost:",-1)),c(" $"+o(a.cost),1)]),a.userNotes?(i(),n("p",we,[e[12]||(e[12]=t("strong",null,"Notes:",-1)),c(" "+o(a.userNotes),1)])):u("",!0)])]),t("div",be,[t("div",ke,[t("span",{class:v(["chip",B(a.status)])},[t("i",Ae,o(j(a.status)),1),c(" "+o(a.status),1)],2)]),t("div",Ce,[a.status==="scheduled"?(i(),n(g,{key:0},[t("button",{onClick:d=>E(),class:"btn waves-effect waves-light teal",disabled:!w(a)},[e[13]||(e[13]=t("i",{class:"material-icons left"},"videocam",-1)),c(" "+o(w(a)?"Join":"Not Ready"),1)],8,Ne),t("button",{onClick:d=>V(),class:"btn-flat waves-effect waves-teal"}," Reschedule ",8,Te),t("button",{onClick:d=>L(a),class:"btn-flat waves-effect waves-red red-text"}," Cancel ",8,Se)],64)):u("",!0),a.status==="completed"?(i(),n(g,{key:1},[A(l,{to:`/rate-counsellor/${a.id}`,class:"btn waves-effect waves-light amber"},{default:C(()=>[...e[14]||(e[14]=[t("i",{class:"material-icons left"},"star",-1),c(" Rate Session ",-1)])]),_:1},8,["to"]),t("button",{onClick:d=>b(a),class:"btn-flat waves-effect waves-teal"}," Book Again ",8,xe)],64)):u("",!0),a.status==="cancelled"?(i(),n("button",{key:2,onClick:d=>b(a),class:"btn waves-effect waves-light teal"},[...e[15]||(e[15]=[t("i",{class:"material-icons left"},"refresh",-1),c(" Book Again ",-1)])],8,Ie)):u("",!0)])])])])]))),128))])])])])}}},Pe=G($e,[["__scopeId","data-v-66934d1b"]]);export{Pe as default};
